### UC 1: Регистрация нового студента

*   **Актёр:** `Гость`
*   **Предусловие:** Пользователь находится на главной странице (лендинге) курса и не аутентифицирован.
*   **Цель:** Создать новую учётную запись с ролью "Студент".

#### **Основной поток событий (Happy Path):**
1.  **Гость** нажимает кнопку "Записаться на курс".
2.  **Система** отображает модальное окно или страницу с формой регистрации, содержащей поля: `Имя`, `Email`, `Пароль`, `Подтверждение пароля`.
3.  **Гость** вводит свои данные во все поля.
4.  **Система (Frontend)** в реальном времени проверяет базовую валидность данных:
    *   Формат email корректен.
    *   Пароль соответствует требованиям безопасности (например, >8 символов).
    *   Значения в полях "Пароль" и "Подтверждение пароля" совпадают.
5.  **Гость** нажимает кнопку "Зарегистрироваться".
6.  **Система (Frontend)** отправляет `POST` запрос с данными формы (`name`, `email`, `password`) на серверный эндпоинт `/api/v1/auth/register`.
7.  **Система (Backend)** получает запрос и выполняет следующие действия:
    а. Валидирует полученные данные (проверяет, что поля не пустые).
    б. Проверяет, что `email` уникален, выполняя запрос к таблице `users` в базе данных.
    в. Хеширует полученный пароль с помощью алгоритма bcrypt.
    г. Создаёт новую запись в таблице `users` с ролью `student`.
8.  **Система (Backend)** возвращает ответ со статусом `201 Created` и данными нового пользователя (без пароля).
9.  **Система (Frontend)** получает успешный ответ, закрывает форму регистрации, показывает уведомление "Вы успешно зарегистрированы!" и перенаправляет пользователя на страницу входа (`/login`).

#### **Альтернативные потоки:**
*   **A1: Email уже существует.**
    *   На шаге 7б, если email найден в базе данных, **Система (Backend)** прерывает выполнение и возвращает ответ с ошибкой `409 Conflict` и сообщением "Пользователь с таким email уже существует".
    *   **Система (Frontend)** получает ошибку, отображает это сообщение под полем `Email` и не закрывает форму.
*   **A2: Пароли не совпадают.**
    *   На шаге 4, если пароли не совпадают, **Система (Frontend)** подсвечивает поля паролей красным и выводит сообщение "Пароли не совпадают". Кнопка "Зарегистрироваться" остаётся неактивной до исправления ошибки.
*   **A3: Ошибка сети.**
    *   На шаге 6, если запрос к серверу не удаётся (нет сети), **Система (Frontend)** показывает уведомление "Ошибка сети. Пожалуйста, проверьте подключение и попробуйте снова".

**Постусловие:** В базе данных создана новая запись о пользователе с ролью "Студент".

![UC1: Signup](/docs/diagrams/UC1.png)

---
### UC 2: Аутентификация пользователя

*   **Актёры:** `Студент`, `Администратор` (любой зарегистрированный пользователь)
*   **Предусловие:** Пользователь находится на странице входа (`/login`).
*   **Цель:** Получить доступ к защищённым разделам системы (личный кабинет или панель администратора).

#### **Основной поток событий (Happy Path):**
1.  **Пользователь** вводит свой `Email` и `Пароль` в соответствующие поля.
2.  **Пользователь** нажимает кнопку "Войти".
3.  **Система (Frontend)** отправляет `POST` запрос с учётными данными на эндпоинт `/api/v1/auth/login`.
4.  **Система (Backend)** получает запрос:
    а. Находит пользователя в таблице `users` по `email`.
    б. Сравнивает хеш введённого пароля с хешем, хранящимся в базе данных.
    в. Если совпадение успешно, генерирует JWT (JSON Web Token), содержащий `userId` и `role` (`student` или `admin`).
5.  **Система (Backend)** возвращает ответ `200 OK` с JWT в теле.
6.  **Система (Frontend)** получает токен и сохраняет его в безопасном месте (например, `HttpOnly cookie`).
7.  **Система (Frontend)** анализирует роль из токена:
    *   Если роль `student`, перенаправляет пользователя на `/dashboard` (личный кабинет).
    *   Если роль `admin`, перенаправляет пользователя на `/admin` (панель администратора).

#### **Альтернативные потоки:**
*   **A1: Пользователь не найден или пароль неверный.**
    *   На шаге 4а или 4б, если пользователь с таким email не найден или пароли не совпадают, **Система (Backend)** возвращает ошибку `401 Unauthorized` с сообщением "Неверный email или пароль".
    *   **Система (Frontend)** отображает это сообщение над формой входа.
*   **A2: Пустые поля.**
    *   На шаге 1, если пользователь нажимает "Войти" с пустыми полями, **Система (Frontend)** подсвечивает их и выводит сообщение "Пожалуйста, заполните все поля". Запрос на сервер не отправляется.

**Постусловие:** Пользователь успешно аутентифицирован и имеет доступ к разделам системы в соответствии со своей ролью.

![UC2: Login](/docs/diagrams/UC2.png)

---
### UC 3: Просмотр урока студентом

*   **Актёр:** `Студент`
*   **Предусловие:** Студент аутентифицирован и находится в личном кабинете на странице курса.
*   **Цель:** Получить доступ к видео, тексту и дополнительным материалам конкретного урока.

#### **Основной поток событий (Happy Path):**
1.  **Студент** видит список модулей и уроков курса.
2.  **Студент** нажимает на название интересующего его урока.
3.  **Система (Frontend)** отправляет `GET` запрос на эндпоинт `/api/v1/lessons/{lessonId}`, передавая JWT для аутентификации.
4.  **Система (Backend)** получает запрос:
    а. Валидирует JWT и извлекает `userId`.
    б. Проверяет, имеет ли данный студент доступ к курсу, которому принадлежит урок (проверка прав).
    в. Если доступ разрешён, извлекает из базы данных всю информацию об уроке: `title`, `description`, `videoUrl`, `attachments` (ссылки на доп. файлы).
5.  **Система (Backend)** возвращает ответ `200 OK` с данными урока в формате JSON.
6.  **Система (Frontend)** получает данные и отображает страницу урока:
    *   Вверху — название урока.
    *   В основной части — встроенный видеплеер с видео по `videoUrl`.
    *   Под плеером — текстовое описание (`description`).
    *   Если есть `attachments`, отображается секция "Дополнительные материалы" со ссылками для скачивания.
7.  **Студент** просматривает видео и изучает материалы.

#### **Альтернативные потоки:**
*   **A1: Доступ запрещён.**
    *   На шаге 4б, если проверка показывает, что студент не имеет доступа к этому курсу, **Система (Backend)** возвращает ошибку `403 Forbidden`.
    *   **Система (Frontend)** перенаправляет пользователя на страницу с сообщением "У вас нет доступа к этому уроку".
*   **A2: Урок не найден.**
    *   На шаге 4в, если урока с таким `lessonId` не существует, **Система (Backend)** возвращает ошибку `404 Not Found`.
    *   **Система (Frontend)** отображает страницу с сообщением "Урок не найден".

**Постусловие:** Студент получил доступ к учебным материалам урока.

![UC3: View](/docs/diagrams/UC3.png)

---
### UC 4: Редактирование контента главной страницы

*   **Актёр:** `Администратор`
*   **Предусловие:** Администратор аутентифицирован и находится в панели управления на странице "Настройки сайта".
*   **Цель:** Изменить брендинг и текстовое наполнение лендинга.

#### **Основной поток событий (Happy Path):**
1.  **Администратор** видит текущие настройки страницы: логотип, баннер, главный заголовок, цвета.
2.  **Администратор** нажимает кнопку "Загрузить новый баннер" и выбирает изображение на своём компьютере.
3.  **Система (Frontend)** немедленно отображает превью нового баннера.
4.  **Администратор** изменяет текст в поле "Главный заголовок".
5.  **Администратор** выбирает новый "Акцентный цвет" с помощью color-picker.
6.  **Система (Frontend)** в реальном времени показывает, как будут выглядеть кнопки с новым цветом.
7.  **Администратор** нажимает кнопку "Сохранить изменения".
8.  **Система (Frontend)** собирает все изменённые данные (файл баннера, текстовые поля, цвета) и отправляет их `PUT` запросом на эндпоинт `/api/v1/admin/settings/landing`.
9.  **Система (Backend)** получает запрос:
    а. Валидирует JWT и роль администратора.
    б. Если был загружен новый файл, сохраняет его в хранилище и получает на него URL.
    в. Валидирует текстовые данные.
    г. Обновляет соответствующую запись в таблице `site_settings` в базе данных.
10. **Система (Backend)** возвращает `200 OK` с обновлёнными настройками.
11. **Система (Frontend)** показывает уведомление "Изменения успешно сохранены".

#### **Альтернативные потоки:**
*   **A1: Недопустимый формат файла.**
    *   На шаге 2, если администратор выбирает файл неверного формата (например, `.txt` вместо `.jpg` или `.png`), **Система (Frontend)** выводит ошибку "Неверный формат файла. Пожалуйста, выберите изображение" и не загружает превью.
*   **A2: Слишком большой файл.**
    *   На шаге 8, если размер файла превышает установленный лимит (например, 5 МБ), **Система (Backend)** возвращает ошибку `413 Payload Too Large`.
    *   **Система (Frontend)** отображает сообщение "Файл слишком большой. Максимальный размер: 5 МБ".

**Постусловие:** Внешний вид и контент главной страницы курса обновлены для всех посетителей.

![UC4: Edit](/docs/diagrams/UC4.png)

---
### UC 5: Удаление урока из курса

*   **Актёр:** `Администратор`
*   **Предусловие:** Администратор аутентифицирован и находится на странице редактирования структуры курса.
*   **Цель:** Безвозвратно удалить урок из учебной программы.

#### **Основной поток событий (Happy Path):**
1.  **Администратор** видит список модулей и уроков.
2.  Напротив названия нужного урока **Администратор** нажимает иконку "Удалить" (корзина).
3.  **Система (Frontend)** отображает модальное окно с подтверждением: "Вы уверены, что хотите удалить урок '{Название урока}'? Это действие нельзя будет отменить".
4.  **Администратор** нажимает кнопку "Да, удалить".
5.  **Система (Frontend)** отправляет `DELETE` запрос на эндпоинт `/api/v1/admin/lessons/{lessonId}`, передавая JWT.
6.  **Система (Backend)** получает запрос:
    а. Валидирует JWT и роль администратора.
    б. Находит урок в таблице `lessons` по `lessonId`.
    в. Удаляет запись об уроке из базы данных.
    г. (Опционально) Удаляет связанный с уроком видеофайл из хранилища, чтобы освободить место.
7.  **Система (Backend)** возвращает ответ `204 No Content`, подтверждающий успешное удаление.
8.  **Система (Frontend)** получает успешный ответ, закрывает модальное окно и динамически удаляет элемент урока из списка в интерфейсе без перезагрузки страницы.
9.  **Система (Frontend)** показывает уведомление "Урок успешно удалён".

#### **Альтернативные потоки:**
*   **A1: Администратор отменяет удаление.**
    *   На шаге 4, **Администратор** нажимает кнопку "Отмена".
    *   **Система (Frontend)** закрывает модальное окно, никаких действий не происходит.
*   **A2: Урок уже был удалён.**
    *   На шаге 6б, если урок с указанным `lessonId` не найден (например, был удалён в другой вкладке), **Система (Backend)** возвращает ошибку `404 Not Found`.
    *   **Система (Frontend)** показывает уведомление "Не удалось удалить урок, так как он уже не существует".

**Постусловие:** Урок полностью удалён из системы и больше недоступен студентам.

![UC5: Delete](/docs/diagrams/UC5.png)